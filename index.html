<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Sorpresa üíú</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #FCE7EC;
      font-family: 'Quicksand', sans-serif;
      color: #5c2a6b;
      text-align: center;
      padding: 30px;
      overflow-x: hidden;
      display: flex; /* Usiamo flexbox per centrare il contenuto sulla pagina */
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    /* Contenitore per gli elementi superiori (titolo, orsetto, barra, biscotti) */
    .top-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px; /* Aggiunto spazio sotto la sezione superiore per distanziare il resto */
    }

    /* Posizionamento fisso per gli elementi in sovrapposizione */
    .timed-message-button,
    .video-link {
      position: fixed;
      z-index: 1000;
    }

    /* Stili per il bottone del messaggio a tempo */
    .timed-message-button {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #ffcce6;
      padding: 15px 25px;
      border-radius: 15px;
      border: 2px solid #e49ecf;
      font-size: 22px;
      color: #5c2a6b;
      cursor: pointer;
      display: none;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.3s ease, background-color 0.3s ease;
      white-space: nowrap;
      z-index: 900; /* Assicurati che sia sopra altri elementi principali, ma sotto pop-up */
    }

    .timed-message-button:hover {
      background-color: #ffb3d9;
      transform: translate(-50%, -50%) scale(1.05);
    }

    /* Stili per la scatola regalo */
    .gift-box-container {
      /* Modifiche qui per il posizionamento e per i messaggi */
      margin: 30px auto 100px auto; /* Pi√π spazio sotto per allontanarsi dal bottone e dal fondo */
      font-size: 80px;
      cursor: pointer;
      position: relative;
      width: fit-content;
      transition: transform 0.2s ease-out;
      z-index: 10; /* Z-index inferiore per essere coperto dai quiz */
    }

    .gift-box-container:hover {
      transform: scale(1.1);
    }

    .gift-box-container:active {
      transform: scale(0.9);
    }

    .gift-message-box {
      display: none;
      position: absolute;
      background-color: rgba(255, 240, 245, 0.95); /* Sfondo semi-trasparente pi√π opaco */
      padding: 10px; /* Padding leggermente aumentato */
      border-radius: 15px; /* Bordi pi√π arrotondati */
      border: 2px solid #e49ecf; /* Bordo coerente con altri elementi */
      z-index: 100;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 280px;
      font-size: 18px;
      text-align: left;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* Ombra pi√π pronunciata */
      white-space: normal;
      color: #5c2a6b;
      /* Rimosso text-shadow, il background e il bordo bastano per la leggibilit√† */
    }

    .orsetto {
      font-size: 60px;
      cursor: pointer;
      animation: bounce 2s infinite ease-in-out;
      transition: transform 0.1s ease-out;
    }

    .orsetto:hover {
      transform: scale(1.1);
    }

    .orsetto:active {
      transform: scale(0.9);
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .biscotti-box {
      margin-top: 20px;
      background-color: #ffe6f0;
      padding: 15px;
      border-radius: 15px;
      display: inline-block;
      border: 2px solid #e49ecf;
    }

    .biscotti-box h2 {
      margin-top: 0;
    }

    .biscotti {
      font-size: 24px;
      margin-top: 10px;
    }

    .biscotti-list {
      margin-top: 10px;
      font-size: 30px;
    }

    .heart-button { /* Stili per il bottone del cuore */
      display: none; /* Sar√† mostrato dal JS */
      margin-top: 20px;
      font-size: 24px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #e49ecf;
      color: white;
      cursor: pointer;
      animation: sparkle 1s infinite alternate;
      z-index: 50; /* Per essere sopra altri elementi nella mainPage */
    }

    @keyframes sparkle {
      from { box-shadow: 0 0 10px #e49ecf; }
      to { box-shadow: 0 0 20px #ff99cc; }
    }

    .mood-bar-container {
      width: 80%;
      max-width: 700px;
      background-color: #ddd;
      border-radius: 20px;
      overflow: hidden;
      margin: 20px auto;
      height: 25px;
      border: 2px solid #ccc;
    }

    .mood-bar {
      height: 100%;
      width: 0%;
      transition: width 0.5s ease, background-color 0.5s ease;
    }

    /* Stili generali per i box dei quiz e risultati */
    .quiz-box, .result-box {
      display: none;
      background-color: #ffe6f0;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #e49ecf;
      margin-top: 30px;
      max-width: 600px;
      width: 90%;
      z-index: 100; /* Assicurati che i quiz siano sopra tutto il resto */
      position: absolute; /* Per sovrapporsi bene */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .question {
      font-size: 20px;
      margin-bottom: 10px;
    }

    .answer {
      display: block;
      margin: 8px auto;
      background-color: #fcd6ec;
      border: none;
      padding: 10px 15px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
      width: 80%;
      max-width: 300px;
    }

    .answer:hover {
      background-color: #ffc3e6;
    }

    .question-page { /* Questa √® la pagina del "Do you like me?" del castoro */
      display: none;
      background-color: #FCE7EC;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      padding: 30px;
      box-sizing: border-box;
      z-index: 999;
      overflow-y: auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .question-content {
      background-color: #ffe6f0;
      padding: 30px;
      border-radius: 20px;
      border: 2px solid #e49ecf;
      max-width: 500px;
      text-align: center;
    }

    .otter-question-text {
      font-size: 28px;
      color: #5c2a6b;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .otter-image {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 20px auto;
    }

    .like-buttons-container {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 40px;
      align-items: center;
      flex-wrap: wrap;
    }

    .like-button {
      font-size: 28px;
      padding: 15px 30px;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease;
      min-width: 150px;
      white-space: nowrap;
    }

    .yes-button {
      background-color: #e49ecf;
      color: white;
      box-shadow: 0 0 10px rgba(228, 158, 207, 0.7);
    }

    .yes-button:hover {
      background-color: #d17fb8;
      transform: scale(1.05);
    }

    .no-button {
      background-color: #fcd6ec;
      color: #5c2a6b;
      border: 2px solid #e49ecf;
    }

    .no-button:hover {
      background-color: #ffc3e6;
    }

    .twenty-biscotti-letter-page {
      display: none;
      background-color: #FCE7EC;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      padding: 30px;
      box-sizing: border-box;
      z-index: 999;
      overflow-y: auto;
    }

    .twenty-biscotti-letter-content {
      background-color: #ffe6f0;
      padding: 30px;
      border-radius: 20px;
      border: 2px solid #e49ecf;
      max-width: 600px;
      margin: 50px auto;
      font-size: 18px;
    }

    .twenty-biscotti-letter-content h2 {
        color: #e49ecf;
        margin-bottom: 20px;
        font-size: 26px;
    }

    /* Lettera "vogliosa" */
    .vogliosa-letter-page {
      display: none;
      background-color: #FCE7EC;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      padding: 30px;
      box-sizing: border-box;
      z-index: 1000;
      overflow-y: auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .vogliosa-letter-content {
      background-color: #ffe6f0;
      padding: 30px;
      border-radius: 20px;
      border: 2px solid #e49ecf;
      max-width: 600px;
      text-align: left;
      font-size: 18px;
      position: relative;
    }

    .close-vogliosa-letter {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #5c2a6b;
    }

    .letter-page { /* Questa √® la lettera finale del "Si! del castoro" */
      display: none;
      background-color: #FCE7EC;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      padding: 30px;
      box-sizing: border-box;
      z-index: 999;
      overflow-y: auto;
    }

    .letter-content {
      background-color: #ffe6f0;
      padding: 30px;
      border-radius: 20px;
      border: 2px solid #e49ecf;
      max-width: 600px;
      margin: 50px auto;
      font-size: 18px;
    }

    .back-btn {
      margin-top: 20px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      background-color: #e49ecf;
      color: white;
      cursor: pointer;
    }

    /* Stili per il link al video */
    .video-link {
      bottom: 20px;
      right: 20px;
      background-color: #fcd6ec;
      padding: 10px 15px;
      border-radius: 10px;
      border: 2px solid #e49ecf;
      font-size: 14px;
      color: #5c2a6b;
      text-decoration: none;
    }

    .video-link:hover {
      background-color: #ffc3e6;
    }

    /* Posizione del lecca-lecca */
    .lollipop-position {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 30px;
      z-index: 500;
      pointer-events: none;
      display: none;
    }

    /* Stile per stitch2.PNG, ora cliccabile */
    .stitch2-image {
        max-width: 300px;
        height: auto;
        margin-top: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        cursor: pointer; /* Aggiunto per renderlo cliccabile */
        transition: transform 0.2s ease-out; /* Animazione al click */
        z-index: 10; /* Assicurati che sia cliccabile e non sotto altri elementi */
    }

    .stitch2-image:hover {
        transform: scale(1.05);
    }
  </style>
</head>
<body>

  <div id="mainPage">
    <div class="top-section">
      <h1>üç™ Clicka l‚Äôorsetto per una sorpresa!</h1>

      <div class="orsetto" onclick="giveBiscotto()">üß∏</div>

      <div class="mood-bar-container">
        <div class="mood-bar" id="moodBar"></div>
      </div>

      <div class="biscotti-box">
        <h2>Biscotti üç™</h2>
        <div id="biscotti">Hai 0 biscotti!</div>
        <div class="biscotti-list" id="biscottiList"></div>
        <p id="biscotto-message" style="margin-top:10px;"></p>
        <button class="heart-button" id="heartBtn" onclick="showOldQuiz()">üíú</button>
      </div>
    </div>

    <div class="quiz-box" id="oldQuizBox">
      <h2>Mini Quiz üí´</h2>
      <div class="question" id="oldQuestion1">
        1. Cosa fai appena torni a casa dopo una giornata pesante?
        <button class="answer" data-question-id="1" onclick="selectOldAnswer(0)">ü•î Mi butto sul letto come una patata</button>
        <button class="answer" data-question-id="1" onclick="selectOldAnswer(1)">üé¨üõèÔ∏è Apro Netflix e mi infilo sotto le coperte</button>
        <button class="answer" data-question-id="1" onclick="selectOldAnswer(2)">üíû Vado a cercare abbracci ovunque</button>
      </div>

      <div class="question" id="oldQuestion2" style="display:none;">
        2. Che tipo di coccole preferisci?
        <button class="answer" data-question-id="2" onclick="selectOldAnswer(0)">ü´Ç Quelle silenziose, solo abbracci forti</button>
        <button class="answer" data-question-id="2" onclick="selectOldAnswer(1)">üç™üì∫ Quelle con biscotti, film e zero pensieri</button>
        <button class="answer" data-question-id="2" onclick="selectOldAnswer(2)">üíå Tutte, anche virtuali se servono</button>
      </div>

      <div class="question" id="oldQuestion3" style="display:none;">
        3. Il tuo mood quando hai il ciclo?
        <button class="answer" data-question-id="3" onclick="selectOldAnswer(0)">üç´ ‚ÄúParlatemi solo se portate cioccolato‚Äù</button>
        <button class="answer" data-question-id="3" onclick="selectOldAnswer(1)">üí§ ‚ÄúVoglio solo dormire 18 ore‚Äù</button>
        <button class="answer" data-question-id="3" onclick="selectOldAnswer(2)">üêºüî• ‚ÄúSono un mix tra un panda e un drago‚Äù</button>
      </div>
    </div>
    <div class="result-box" id="oldResultBox"></div>


    <div class="quiz-box" id="piccanteQuizBox">
      <h2>Quiz Piccante üíã</h2>

      <div class="question" id="piccanteQuestion1">
        1. Se siamo sul divano e le mie mani iniziano a esplorare sotto la coperta, tu‚Ä¶
        <button class="answer" data-question-id="1" onclick="selectPiccanteAnswer(1)">üòá Fai finta di niente, ma ti mordi il labbro</button>
        <button class="answer" data-question-id="1" onclick="selectPiccanteAnswer(2)">üî• Ti giri verso di me e sussurri "continua"</button>
        <button class="answer" data-question-id="1" onclick="selectPiccanteAnswer(3)">üòè Prendi il controllo e mi blocchi le mani</button>
      </div>

      <div class="question" id="piccanteQuestion2" style="display:none;">
        2. Come preferisci essere toccat…ô?
        <button class="answer" data-question-id="2" onclick="selectPiccanteAnswer(1)">‚ú® Con lentezza, come se ogni centimetro fosse sacro</button>
        <button class="answer" data-question-id="2" onclick="selectPiccanteAnswer(2)">üí• Forte, deciso, senza esitazioni</button>
        <button class="answer" data-question-id="2" onclick="selectPiccanteAnswer(3)">üíã Prima dolce‚Ä¶ poi fammi perdere la testa</button>
      </div>

      <div class="question" id="piccanteQuestion3" style="display:none;">
        3. In una notte lunga e senza freni, cosa non pu√≤ mancare?
        <button class="answer" data-question-id="3" onclick="selectPiccanteAnswer(1)">üïØÔ∏è Atmosfera: luci soffuse, pelle contro pelle</button>
        <button class="answer" data-question-id="3" onclick="selectPiccanteAnswer(2)">üó£Ô∏è Parole sussurrate e ordini da seguire</button>
        <button class="answer" data-question-id="3" onclick="selectPiccanteAnswer(3)">ü•µ Uno specchio‚Ä¶ o due</button>
      </div>

      <div class="question" id="piccanteQuestion4" style="display:none;">
        4. Se ti sussurro "voglio sentirti tremare", tu‚Ä¶
        <button class="answer" data-question-id="4" onclick="selectPiccanteAnswer(1)">üíû Mi dici ‚Äúallora fallo‚Äù e chiudi gli occhi</button>
        <button class="answer" data-question-id="4" onclick="selectPiccanteAnswer(2)">üß∑ Mi guardi negli occhi e dici ‚Äúmostrami quanto‚Äù</button>
        <button class="answer" data-question-id="4" onclick="selectPiccanteAnswer(3)">üêæ Ti mordi il collo da sola e dici ‚Äúsei in ritardo‚Äù</button>
      </div>
    </div>

    <div class="result-box" id="piccanteResultBox"></div>

    <img src="stitch2.PNG" alt="Stitch Felice" class="stitch2-image" onclick="showPiccanteQuiz()">

  </div>

  <button class="timed-message-button" id="timedMessageButton" onclick="showVogliosaLetter()">
    ‚ö†Ô∏èCLICCA SE SEI VOGLIOSA‚ö†Ô∏è
  </button>

  <div class="gift-box-container" id="giftBox" onclick="toggleGiftMessage()">
    üéÅ
    <div class="gift-message-box" id="giftMessageBox"></div>
  </div>


  <div class="question-page" id="questionPage">
    <div class="question-content">
      <div class="otter-question-text">Do you like me?</div>
      <img src="castoro.JPG" alt="Un orsetto con fiori che chiede 'Do you like me?'" class="otter-image">
      <div class="like-buttons-container">
        <button id="yesButton" class="like-button yes-button">S√¨! üíú</button>
        <button id="noButton" class="like-button no-button">No... üòî</button>
      </div>
    </div>
  </div>

  <div class="twenty-biscotti-letter-page" id="twentyBiscottiLetterPage">
    <div class="twenty-biscotti-letter-content">
      <h2>Tesoro mio,</h2>
      <p>Questa non √® solo una lettera, ma un piccolo pensiero pieno d‚Äôamore per ricordarti una cosa semplice ma importantissima: ti voglio un bene infinito.</p>
      <p>Ogni giorno che passa mi rendo conto di quanto tu sia speciale per me. Il mio affetto per te resta sempre lo stesso. Sei una persona speciale, con un cuore d‚Äôoro, e mi sento davvero fortunato/a ad averti nella mia vita.</p>
      <p>Non servono grandi gesti o parole complicate per dirti quanto ci tengo: basta guardare quanto spesso ti penso e quanto il tuo sorriso riesce a cambiare anche le mie giornate pi√π grigie.</p>
      <p>Spero che questo piccolo pensiero riesca a strapparti un sorriso. Anche quando non te ne accorgi, ti porto sempre con me.</p>
      <p>Con tantissimo affetto,<br>Il tuo piccolo rompiscatole che non smette mai di pensarti üíå</p>
      <button class="back-btn" onclick="goBackFromTwentyBiscottiLetter()">üîô Torna alla pagina principale</button>
    </div>
  </div>

  <div class="vogliosa-letter-page" id="vogliosaLetterPage">
    <div class="vogliosa-letter-content">
      <button class="close-vogliosa-letter" onclick="closeVogliosaLetter()">‚úñÔ∏è</button>
      <p>Ora che hai cliccato, non puoi pi√π tornare indietro.</p>
      <p>Hai accettato il gioco. Il mio gioco.</p>
      <p>Immagina le mie mani scivolare lente lungo la tua schiena, la mia bocca che si ferma sul tuo collo solo per farti tremare.</p>
      <p>Ti voglio distesa, sotto di me, mentre ti prendo piano e poi pi√π forte, fino a farti perdere il respiro.</p>
      <p>Ogni tuo gemito sar√† mio. Ogni brivido, ogni carezza, ogni ordine sussurrato al tuo orecchio.</p>
      <p>Tu, completamente mia.</p>
      <p>E io?<br>Io non mi fermer√≤ finch√© non ti avr√≤ sentita cedere, tremare, godere.</p>
    </div>
  </div>

  <img src="stitch1.PNG" alt="Stitch curioso" style="max-width: 100%; height: auto; margin-top: 20px;">


  <div class="letter-page" id="letterPage">
    <div class="letter-content">
      üíå Grazie per aver cliccato fino a qui‚Ä¶
      <br><br>
      Volevo solo dirti che ti voglio un bene da morire.
      Sei speciale, e anche se non posso sempre starti vicino, ci tengo davvero tanto a te.
      Ti penso spesso, anche nei momenti pi√π piccoli.
      <br><br>
      üß∏üíú
      ‚Äî Tuo rompiscatole preferito
      <br><br>
      <button class="back-btn" onclick="goBack()">üîô Torna alla pagina principale</button>
    </div>
  </div>


  <a href="http://www.youtube.com/watch?v=RlQLdGGDa_4" class="video-link" target="_blank">Clicca se sei triste</a>

  <span id="candyEmoji" class="lollipop-position">üç≠</span>

  <script>
    let biscotti = 0;
    let oldAnswers = []; // Array per le risposte del Vecchio Quiz
    let currentOldQuestion = 1; // Variabile per tracciare la domanda corrente del Vecchio Quiz

    let piccanteAnswers = []; // Array per le risposte del Quiz Piccante
    let currentPiccanteQuestion = 1; // Variabile per tracciare la domanda corrente del Quiz Piccante

    let yesScale = 1;
    let noScale = 1;
    let noOpacity = 1;

    let yesButton, noButton;

    const moodBarColors = [
        "#5c2a6b", // Colore iniziale
        "#8a2be2",
        "#ff007f",
        "#ffa500",
        "#ff0000" // Colore finale
    ];

    const giftMessages = [
        "Lo sapevi che le lontre si tengono per mano mentre dormono per non perdersi? ü¶¶üí§ü§ù",
        "I cavallucci marini si innamorano e danzano insieme ogni mattina. üêöüíÉüê¥",
        "I pinguini regalano sassi alla loro dolce met√† per dimostrare amore. üêßüíéüíï",
        "Le volpi dormono abbracciandosi per scaldarsi e sentirsi al sicuro. ü¶äüõèÔ∏è‚ù§Ô∏è",
        "Le mucche hanno migliori amiche e si stressano se vengono separate. üêÆüëØ‚Äç‚ôÄÔ∏èüò¢",
        "Gli elefanti ricordano per tutta la vita chi ha mostrato loro gentilezza. üêòüß†üíñ",
        "Alcuni pappagalli si danno bacini e si chiamano a voce se si perdono di vista. ü¶úüíãüîä",
        "I cani possono piangere di gioia quando rivedono una persona amata. üê∂ü•πüíß",
        "Le api danzano per raccontarsi dove trovare i fiori migliori. üêùüå∏ü©∞",
        "Le tartarughe si accarezzano con il muso per salutarsi. üê¢üëÉüíû"
    ];

    let currentGiftMessageIndex = 0;
    let isGiftMessageVisible = false; // Nuovo stato per il messaggio regalo

    // Frase per il lecca-lecca
    const candyMessage = "Federica, il tuo sorriso ha qualcosa di magico: riesce a rendere bello anche il giorno pi√π normale. Non smettere mai di sorridere, perch√© il mondo ha bisogno di quella luce che solo tu sai dare";

    // Funzione per mostrare/nascondere il messaggio regalo
    function toggleGiftMessage() {
      const giftMessageBox = document.getElementById('giftMessageBox');
      if (isGiftMessageVisible) {
        giftMessageBox.style.display = "none";
        isGiftMessageVisible = false;
      } else {
        giftMessageBox.innerText = giftMessages[currentGiftMessageIndex];
        giftMessageBox.style.display = "block";
        isGiftMessageVisible = true;
        currentGiftMessageIndex = (currentGiftMessageIndex + 1) % giftMessages.length;
      }
    }

    // Aggiungi un event listener per chiudere il messaggio regalo cliccando fuori
    document.addEventListener('click', (event) => {
        const giftBox = document.getElementById('giftBox');
        const giftMessageBox = document.getElementById('giftMessageBox');
        // Se il click non √® all'interno della scatola regalo o del suo messaggio, e il messaggio √® visibile, nascondilo
        if (isGiftMessageVisible && !giftBox.contains(event.target)) {
            giftMessageBox.style.display = "none";
            isGiftMessageVisible = false;
        }
    });

    function setupQuestionPageButtons() {
      if (!yesButton) {
        yesButton = document.getElementById('yesButton');
        noButton = document.getElementById('noButton');

        noButton.addEventListener('click', () => {
          noScale = Math.max(0.05, noScale - 0.2);
          yesScale = Math.min(2.5, yesScale + 0.25);
          noOpacity = Math.max(0, noOpacity - 0.25);

          updateButtonSizes();
        });

        yesButton.addEventListener('click', () => {
          showLetterPage();
        });
      }
    }

    function updateButtonSizes() {
      if (yesButton && noButton) {
        yesButton.style.transform = `scale(${yesScale})`;
        noButton.style.transform = `scale(${noScale})`;
        noButton.style.opacity = noOpacity;

        if (noScale < 0.2 || noOpacity < 0.1) {
          noButton.style.pointerEvents = 'none';
          noButton.style.display = 'none';
        } else {
          noButton.style.pointerEvents = 'auto';
          noButton.style.display = 'block';
        }
      }
    }

    function giveBiscotto() {
      biscotti++;
      document.getElementById('biscotti').innerText = `Hai ${biscotti} biscotti!`;

      const biscottiList = document.getElementById('biscottiList');
      const newBiscotto = document.createElement("span");
      newBiscotto.innerText = "üç™ ";
      biscottiList.appendChild(newBiscotto);

      updateMoodBar();

      // Assicurati che il bottone del cuore sia visibile quando i biscotti sono >= 5
      if (biscotti >= 5) {
        document.getElementById('heartBtn').style.display = "inline-block";
      }

      // Mostra il lecca-lecca a 10 biscotti e la sua frase
      if (biscotti >= 10) {
        document.getElementById('candyEmoji').style.display = "block";
        document.getElementById('biscotto-message').innerText = candyMessage;
      } else {
        document.getElementById('candyEmoji').style.display = "none";
        document.getElementById('biscotto-message').innerText = "Anche se non sono l√¨ con te, tieni questo üç™";
      }

      if (biscotti === 20) {
        showTwentyBiscottiLetter();
      }
    }

    function updateMoodBar() {
      const bar = document.getElementById('moodBar');
      let percentage = Math.min((biscotti / 20) * 100, 100);
      bar.style.width = percentage + "%";

      let colorIndex;
      if (biscotti <= 4) {
        colorIndex = 0;
      } else if (biscotti <= 9) {
        colorIndex = 1;
      } else if (biscotti <= 14) {
        colorIndex = 2;
      } else if (biscotti <= 19) {
        colorIndex = 3;
      } else {
        colorIndex = 4;
      }
      bar.style.backgroundColor = moodBarColors[colorIndex];
    }

    function showTwentyBiscottiLetter() {
        hideAllPages();
        document.getElementById('twentyBiscottiLetterPage').style.display = "block";
    }

    function showLetterPage() {
        hideAllPages();
        document.getElementById('letterPage').style.display = "block";

        if (yesButton) {
            yesButton.style.animation = 'sparkle 1s infinite alternate';
            setTimeout(() => {
                if (yesButton) {
                    yesButton.style.animation = '';
                }
            }, 2000);
        }
    }

    function showVogliosaLetter() {
        hideAllPages();
        document.getElementById('vogliosaLetterPage').style.display = "flex";
    }

    function closeVogliosaLetter() {
        document.getElementById('vogliosaLetterPage').style.display = "none";
        showMainPage(); // Torna alla pagina principale
        resetAppState(); // Resetta lo stato del gioco
        startTimedMessage(); // Riprende il timer del bottone vogliosa
    }

    // --- LOGICA VECCHIO QUIZ (ORIGINALE) ---
    function showOldQuiz() {
        hideAllPages();
        document.getElementById('oldQuizBox').style.display = "block";
        // Nascondi scatola regalo e stitch quando il quiz del cuore √® attivo
        document.getElementById('giftBox').style.display = "none";
        document.querySelector('.stitch2-image').style.display = "none";

        oldAnswers = []; // Resetta le risposte
        currentOldQuestion = 1; // Resetta la domanda corrente
        showOldQuestion(1);
    }

    function showOldQuestion(n) {
      document.querySelectorAll('#oldQuizBox .question').forEach(q => q.style.display = 'none');
      const currentQ = document.getElementById(`oldQuestion${n}`);
      if (currentQ) {
        currentQ.style.display = 'block';
        document.querySelectorAll(`#oldQuestion${n} .answer`).forEach(btn => {
          btn.style.display = "block";
        });
      }
    }

    function selectOldAnswer(val) {
      oldAnswers.push(val);
      currentOldQuestion++;
      if (currentOldQuestion <= 3) {
        showOldQuestion(currentOldQuestion);
      } else {
        showOldResult();
      }
    }

    function showOldResult() {
      let resultText = "";
      const total = oldAnswers.reduce((a, b) => a + b, 0);
      if (total <= 2) resultText = "ü•î Patatella da coccolare";
      else if (total <= 4) resultText = "üëë Regina del Relax";
      else resultText = "üêØ Tigre tenera con cuore gigante";

      document.getElementById('oldQuizBox').style.display = "none";
      document.getElementById('oldResultBox').style.display = "block";
      document.getElementById('oldResultBox').innerHTML = `<h2>Risultato:</h2><p>${resultText}</p>`;

      setTimeout(() => {
        hideAllPages();
        document.getElementById('questionPage').style.display = "flex"; // Vai alla pagina del castoro
        yesScale = 1;
        noScale = 1;
        noOpacity = 1;
        setupQuestionPageButtons();
        updateButtonSizes();
      }, 1500);
    }
    // --- FINE LOGICA VECCHIO QUIZ ---


    // --- LOGICA NUOVO QUIZ PICCANTE ---
    function showPiccanteQuiz() {
        hideAllPages();
        document.getElementById('piccanteQuizBox').style.display = "block";
        // Nascondi scatola regalo e stitch (perch√© sei gi√† nel suo quiz)
        document.getElementById('giftBox').style.display = "none";
        document.querySelector('.stitch2-image').style.display = "none"; // Non serve, ma per coerenza

        piccanteAnswers = []; // Resetta le risposte
        currentPiccanteQuestion = 1; // Resetta la domanda corrente
        showPiccanteQuestion(1);
    }

    function showPiccanteQuestion(n) {
      document.querySelectorAll('#piccanteQuizBox .question').forEach(q => q.style.display = 'none');
      const currentQ = document.getElementById(`piccanteQuestion${n}`);
      if (currentQ) {
        currentQ.style.display = 'block';
        document.querySelectorAll(`#piccanteQuestion${n} .answer`).forEach(btn => {
          btn.style.display = "block";
        });
      }
    }

    function selectPiccanteAnswer(val) {
      piccanteAnswers.push(val);
      currentPiccanteQuestion++;
      if (currentPiccanteQuestion <= 4) {
        showPiccanteQuestion(currentPiccanteQuestion);
      } else {
        showPiccanteResult();
      }
    }

    function showPiccanteResult() {
      let resultText = "";
      const ans = piccanteAnswers.join('-'); // Crea la stringa delle risposte es: "1-1-1-1"

      switch(ans) {
        case "1-1-1-1":
          resultText = "üíñ Tenera e Ardente ‚Äî Ti lasci andare lentamente, ma sotto sotto bruci. Vuoi essere toccata come un segreto svelato, e io sono pronto a scoprirti.";
          break;
        case "2-2-2-2":
          resultText = "üî• Affamata di Piacere ‚Äî Ti basta un tocco per accenderti. Sei un fuoco sotto la pelle, e non vedi l‚Äôora di bruciare tra le mie mani.";
          break;
        case "3-3-3-3":
          resultText = "üòà Domina Totale ‚Äî Sei tu che comandi, e lo fai senza piet√†. Sai cosa vuoi, e quando lo prendi‚Ä¶ non lasci scampo. Voglio essere il tuo giocattolo stanotte.";
          break;
        case "1-3-2-2":
          resultText = "üå∂Ô∏è Docile a modo tuo ‚Äî Ti fai guidare, ma solo quando decidi tu. Ami lasciarti andare, ma sei tu a dettare il ritmo, i brividi‚Ä¶ e i gemiti.";
          break;
        case "2-1-3-3":
          resultText = "üç´ Finta Innocente ‚Äî Sembri timida, delicata‚Ä¶ poi ti sciogli come cioccolato caldo e mi fai impazzire. Sei dolce solo per provocarmi.";
          break;
        case "3-2-1-1":
          resultText = "üéØ Tattica e Seduttiva ‚Äî Ogni tuo tocco √® calcolato. Ogni movimento una promessa. Tu seduci senza chiedere il permesso‚Ä¶ e io ci casco ogni volta.";
          break;
        default:
          resultText = "üíã Irresistibile Misteriosa ‚Äî Le tue risposte sono un mix unico. Sei fatta di sorprese, sguardi che parlano, desideri che esplodono piano. E io voglio scoprire ogni tuo lato. üòò";
      }

      document.getElementById('piccanteQuizBox').style.display = "none";
      document.getElementById('piccanteResultBox').style.display = "block";
      document.getElementById('piccanteResultBox').innerHTML = `<h2>Il tuo lato segreto √®:</h2><p>${resultText}</p><button class="back-btn" onclick="goBackFromPiccanteQuiz()">üîô Torna alla pagina principale</button>`;
    }

    function goBackFromPiccanteQuiz() {
        document.getElementById('piccanteResultBox').style.display = "none";
        showMainPage(); // Torna alla pagina principale
        resetAppState(); // Resetta lo stato del gioco
        startTimedMessage(); // Riprende il timer del bottone vogliosa
    }
    // --- FINE LOGICA NUOVO QUIZ PICCANTE ---


    function goBackFromTwentyBiscottiLetter() {
        document.getElementById('twentyBiscottiLetterPage').style.display = "none";
        showMainPage();
        resetAppState();
        startTimedMessage();
    }

    function goBack() { // Usato dalla lettera finale del castoro
        document.getElementById('letterPage').style.display = "none";
        showMainPage();
        resetAppState();
        startTimedMessage();
    }

    // Funzione per mostrare la mainPage e gli elementi che vi appartengono
    function showMainPage() {
        document.getElementById('mainPage').style.display = "flex";
        document.getElementById('giftBox').style.display = "block"; // Mostra di nuovo la scatola regalo
        document.querySelector('.stitch2-image').style.display = "block"; // Mostra di nuovo Stitch
    }


    function hideAllPages() {
        document.getElementById('mainPage').style.display = "none";
        document.getElementById('oldQuizBox').style.display = "none"; // Vecchio quiz
        document.getElementById('oldResultBox').style.display = "none"; // Risultato vecchio quiz
        document.getElementById('piccanteQuizBox').style.display = "none"; // Nuovo quiz
        document.getElementById('piccanteResultBox').style.display = "none"; // Risultato nuovo quiz
        document.getElementById('questionPage').style.display = "none"; // Pagina castoro "Do you like me?"
        document.getElementById('twentyBiscottiLetterPage').style.display = "none";
        document.getElementById('letterPage').style.display = "none";
        document.getElementById('vogliosaLetterPage').style.display = "none";
        document.getElementById('timedMessageButton').style.display = "none";
        document.getElementById('giftMessageBox').style.display = "none"; // Nascondi il messaggio regalo quando si cambia pagina
        isGiftMessageVisible = false; // Resetta lo stato del messaggio regalo
    }

    function resetAppState() {
      biscotti = 0;
      document.getElementById('biscotti').innerText = `Hai ${biscotti} biscotti!`;
      document.getElementById('biscottiList').innerHTML = "";
      document.getElementById('biscotto-message').innerText = "Anche se non sono l√¨ con te, tieni questo üç™";
      document.getElementById('heartBtn').style.display = "none"; /* Nascondi il bottone del cuore al reset */
      document.getElementById('candyEmoji').style.display = "none";
      updateMoodBar();
      // Reset per il vecchio quiz
      oldAnswers = [];
      currentOldQuestion = 1;
      // Reset per il quiz piccante
      piccanteAnswers = [];
      currentPiccanteQuestion = 1;

      document.getElementById('timedMessageButton').style.display = "none";
      document.getElementById('giftMessageBox').style.display = "none";
      isGiftMessageVisible = false;

      // Al reset, assicurati che la scatola regalo e Stitch siano di nuovo visibili sulla main page
      document.getElementById('giftBox').style.display = "block";
      document.querySelector('.stitch2-image').style.display = "block";

      startTimedMessage();
    }

    let timedMessageTimeout;
    function startTimedMessage() {
        clearTimeout(timedMessageTimeout);
        timedMessageTimeout = setTimeout(() => {
            const mainPageIsActive = document.getElementById('mainPage').style.display !== 'none';
            const quizActive = document.getElementById('oldQuizBox').style.display !== 'none' ||
                               document.getElementById('oldResultBox').style.display !== 'none' ||
                               document.getElementById('piccanteQuizBox').style.display !== 'none' ||
                               document.getElementById('piccanteResultBox').style.display !== 'none' ||
                               document.getElementById('questionPage').style.display !== 'none' ||
                               document.getElementById('twentyBiscottiLetterPage').style.display !== 'none' ||
                               document.getElementById('letterPage').style.display !== 'none' ||
                               document.getElementById('vogliosaLetterPage').style.display !== 'none';

            if (mainPageIsActive && !quizActive && document.getElementById('timedMessageButton').style.display === 'none') {
                document.getElementById('timedMessageButton').style.display = 'block';
            }
        }, 5000);
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupQuestionPageButtons();
      // Inizializza mostrando solo la mainPage
      hideAllPages(); // Nasconde tutto per sicurezza
      showMainPage(); // Mostra solo la mainPage e i suoi elementi iniziali
      updateMoodBar();
      startTimedMessage();
    });

    // Modifiche per assicurarsi che il timedMessageButton venga nascosto quando si accede ad altre pagine
    // e per assicurare la visibilit√† di Stitch e Giftbox quando si torna alla mainPage
    const originalShowTwentyBiscottiLetter = showTwentyBiscottiLetter;
    showTwentyBiscottiLetter = function() {
        originalShowTwentyBiscottiLetter();
        document.getElementById('timedMessageButton').style.display = 'none';
        clearTimeout(timedMessageTimeout);
    }

    const originalShowLetterPage = showLetterPage;
    showLetterPage = function() {
        originalShowLetterPage();
        document.getElementById('timedMessageButton').style.display = 'none';
        clearTimeout(timedMessageTimeout);
    }

    const originalShowVogliosaLetter = showVogliosaLetter;
    showVogliosaLetter = function() {
        originalShowVogliosaLetter();
        document.getElementById('timedMessageButton').style.display = 'none';
        clearTimeout(timedMessageTimeout);
    }
    const originalShowPiccanteQuiz = showPiccanteQuiz;
    showPiccanteQuiz = function() {
        originalShowPiccanteQuiz();
        document.getElementById('timedMessageButton').style.display = 'none';
        clearTimeout(timedMessageTimeout);
    }
    const originalShowOldQuiz = showOldQuiz;
    showOldQuiz = function() {
        originalShowOldQuiz();
        document.getElementById('timedMessageButton').style.display = 'none';
        clearTimeout(timedMessageTimeout);
    }
  </script>
</body>
</html>
