<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sai quanto ti amo?</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Variabili CSS */
    :root {
      /* Colori Fase 1 (Introduzione) */
      --intro-bg-color: #fef1f5; /* Rosa chiaro */
      --intro-text-color: #333; /* Testo scuro */
      --intro-clickable-hover: #ffc8d3; /* Hover per l'immagine cliccabile */

      /* Colori Fase 2 (Quiz - Sfondo viola scuro) */
      --quiz-bg-color: #372D56; /* Viola scuro dominante dall'immagine del corvo che dorme */
      --quiz-text-color: #F5F5F5; /* Testo molto chiaro per leggibilità su sfondo scuro */
      --quiz-font: 'Inter', sans-serif;
      --quiz-primary-color: #6a05ad; /* Viola scuro/intenso per bottoni/selezione */
      --quiz-button-hover-color: #8b008b;
      --quiz-border-color: #C8C1DA; /* Bordo più chiaro per contrasto */
      --quiz-container-bg: rgba(55, 45, 86, 0.9); /* Container viola scuro leggermente trasparente */
      --quiz-shadow-color: rgba(0, 0, 0, 0.4);

      --quiz-question-color: #E0E0E0; /* Domande in un colore molto chiaro su sfondo scuro */

      /* Colori Fase 3 (Risultato - Sfondo viola chiaro) */
      --result-bg-color: #E8E6FC; /* Lavanda molto chiaro */
      --result-text-color: #333; /* Testo scuro */
      --result-primary-color: #6a05ad;
      --result-container-bg: #f5f3ff; /* Container risultato viola chiaro */
      --result-shadow-color: rgba(0, 0, 0, 0.15);

      --transition-speed: 0.8s;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif; /* Font di base, verrà sovrascritto */
      background-color: var(--intro-bg-color); /* Rosa chiaro iniziale */
      color: var(--intro-text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      transition: all 0.8s ease;
      text-align: center;
      position: relative; /* Per posizionamento assoluto delle sezioni */
    }

    #container {
      max-width: 90%;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
      position: relative; /* Necessario per sezioni page-section assolute */
      min-height: 500px; /* Altezza minima per il container */
    }

    /* Stili per la Fase 2 (Quiz) */
    body.phase-2 {
        background-color: var(--quiz-bg-color);
        color: var(--quiz-text-color); /* Testo base chiaro */
        font-family: var(--quiz-font);
    }
    .container.phase-2 {
        background-color: var(--quiz-container-bg);
        box-shadow: 0 8px 20px var(--quiz-shadow-color);
        max-width: 95%;
        padding: 30px 20px;
        color: var(--quiz-text-color);
    }

    /* Stili per la Fase 3 (Risultato) */
    body.phase-3 {
        background-color: var(--result-bg-color);
        color: var(--result-text-color);
        font-family: var(--quiz-font);
    }
    .container.phase-3 {
        background-color: var(--result-container-bg);
        box-shadow: 0 8px 20px var(--result-shadow-color);
        max-width: 95%;
        padding: 30px 20px;
        color: var(--result-text-color);
        /* Altezza ridotta per far vedere il viola sotto */
        min-height: auto; /* Rimuovi min-height */
        height: auto;
        padding-bottom: 20px; /* Padding inferiore per il contenuto */
    }

    .hidden {
      display: none;
    }

    /* Stili introduttivi romantici con font originale */
    #intro h1 {
        font-family: 'Segoe UI', sans-serif; /* Font originale per il titolo intro */
        color: #e91e63; /* Rosa più profondo */
        font-size: 2.8em;
        margin-bottom: 10px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    #intro p {
        font-family: 'Segoe UI', sans-serif; /* Font originale per il sottotitolo intro */
        font-size: 1.2em;
        color: #555;
        margin-bottom: 30px;
        line-height: 1.5;
    }

    #intro-image {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
        margin-top: 20px;
        border: 4px solid var(--intro-clickable-hover);
    }
    #intro-image:hover {
        transform: scale(1.08);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    }

    .phase-2 h1, .phase-2 h2 {
        color: var(--quiz-primary-color);
        margin-bottom: 25px;
        font-weight: 700;
    }
    .phase-3 h2 {
        color: var(--result-primary-color);
        margin-bottom: 25px;
        font-weight: 700;
    }

    .question-section {
        margin-bottom: 30px;
        text-align: left;
    }

    .question-section p {
      font-size: 1.15em;
      margin-bottom: 15px;
      color: var(--quiz-question-color); /* Colore delle domande (chiaro) */
      font-weight: bold;
    }

    .options label {
        display: block;
        background-color: var(--quiz-container-bg); /* Container viola scuro leggermente trasparente */
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease, border-color 0.3s ease;
        border: 1px solid var(--quiz-border-color); /* Bordo chiaro */
        font-size: 1em;
        color: var(--quiz-text-color); /* Testo opzioni chiaro */
    }

    .options label:hover {
        background-color: rgba(255, 255, 255, 0.2);
        border-color: var(--quiz-primary-color);
    }

    .options input[type="radio"] {
        display: none;
    }

    .options input[type="radio"]:checked + label {
        background-color: var(--quiz-primary-color);
        border-color: var(--quiz-primary-color);
        color: white;
    }

    .phase-2 button {
        background-color: var(--quiz-primary-color);
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 20px;
    }

    .phase-2 button:hover {
        background-color: var(--quiz-button-hover-color);
        transform: translateY(-2px);
    }

    .phase-2 button:disabled {
        background-color: #999;
        cursor: not-allowed;
        transform: translateY(0);
    }

    .phase-3 button {
        background-color: var(--result-primary-color);
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 8px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        margin-top: 20px;
    }
    .phase-3 button:hover {
        background-color: #8b008b;
        transform: translateY(-2px);
    }

    #quiz-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    #quiz-navigation button {
        flex-grow: 1;
        margin: 0 5px;
    }
    #quiz-navigation button:first-child { margin-left: 0; }
    #quiz-navigation button:last-child { margin-right: 0; }

    #summary {
        list-style: none;
        padding: 0;
        margin-bottom: 20px; /* Spazio prima della frase finale */
    }
    #summary li {
        margin-bottom: 10px;
        line-height: 1.4;
    }
    #summary strong {
        display: block; /* Metti la domanda su una nuova riga */
        margin-bottom: 5px;
    }

    #final-phrase {
        font-size: 1.4em;
        font-style: italic;
        margin-bottom: 30px;
        color: var(--result-primary-color);
        word-wrap: break-word;
    }

    /* Immagine finale del corvo fuori dal container dei risultati */
    #final-image-wrapper {
        position: absolute; /* Posizionamento assoluto rispetto al body o container principale */
        bottom: 20px; /* Posizionalo in basso */
        left: 50%;
        transform: translateX(-50%); /* Centra orizzontalmente */
        width: 150px;
        height: 150px;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10; /* Assicurati che sia sopra altri elementi */
    }
    #final-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.3s ease-out;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    #final-image:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }

    /* Gestione delle sezioni con opacità per transizioni fluide */
    .page-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%; /* Copre l'altezza del container */
        padding: inherit;
        box-sizing: border-box;
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--transition-speed) ease-in-out, transform var(--transition-speed) ease-in-out;
        transform: translateY(20px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        /* Per il risultato, il contenuto deve stare in alto, non centrato verticalmente */
        justify-content: center;
    }
    .page-section.active {
        opacity: 1;
        pointer-events: all;
        transform: translateY(0);
        position: static;
    }
    .page-section:not(.active) {
        display: none;
    }

    /* Regola il giustificamento del contenuto per la sezione risultato */
    #result-section.page-section.active {
        justify-content: flex-start; /* Allinea il contenuto in alto */
        padding-top: 50px; /* Spazio dall'alto */
        height: auto; /* Permetti al contenuto di dettare l'altezza */
    }

    .container.transitioning {
        overflow: hidden;
    }


    /* Media queries per una migliore responsività */
    @media (max-width: 600px) {
        .container {
            padding: 20px;
            margin: 10px;
        }

        #intro h1 {
            font-size: 2.2em;
        }
        #intro p {
            font-size: 1em;
        }
        #intro-image {
            width: 150px;
            height: 150px;
        }

        .phase-2 h1, .phase-2 h2, .phase-3 h2 {
            font-size: 1.6em;
        }

        .question-section p {
            font-size: 1em;
        }

        .options label {
            padding: 12px;
            font-size: 0.95em;
        }

        .phase-2 button, .phase-3 button {
            padding: 12px 20px;
            font-size: 1em;
        }

        #final-phrase {
            font-size: 1.2em;
        }
        #quiz-navigation {
            flex-direction: column;
        }
        #quiz-navigation button {
            width: 100%;
            margin-top: 10px;
        }

        #final-image-wrapper {
            bottom: 10px; /* Riduci il margine dal basso su schermi piccoli */
            width: 120px;
            height: 120px;
        }
    }
  </style>
</head>
<body class="phase-1">
  <div id="container">

    <div id="intro" class="page-section active">
      <h1>Sai quanto ti amo?</h1>
      <p>Clicca per scoprire il mio amore verso di te.</p>
      <img src="corvocarino.JPG" alt="Cliccami per scoprire" id="intro-image">
    </div>

    <div id="pre-quiz-section" class="page-section">
        <h2>Ora che hai cliccato… vediamo il tuo lato nascosto.</h2>
        <button id="start-quiz-button">Inizia il Quiz</button>
    </div>

    <div id="quiz-section" class="page-section">
        <div id="quizContent">
            </div>
        <div id="quiz-navigation">
            <button id="prev-question-button" class="hidden">Precedente</button>
            <button id="next-question-button">Successivo</button>
            <button id="submit-quiz" class="hidden" disabled>Scopri la tua verità</button>
        </div>
    </div>

    <div id="result-section" class="page-section">
      <h2>La verità non consola. Ma almeno ti guarda in faccia.</h2>
      <ul id="summary" style="list-style: none; padding: 0;"></ul>
      <p id="final-phrase">Questa è la mia verità. Scoprila anche tu!</p>
    </div>
  </div>

  <div id="final-image-wrapper" class="hidden">
    <img src="corvo.JPG" alt="Condividi su WhatsApp" id="final-image">
  </div>


  <script>
    const introSection = document.getElementById('intro');
    const introImage = document.getElementById('intro-image');
    const preQuizSection = document.getElementById('pre-quiz-section');
    const startQuizButton = document.getElementById('start-quiz-button');
    const quizSection = document.getElementById('quiz-section');
    const quizContent = document.getElementById('quizContent');
    const prevButton = document.getElementById('prev-question-button');
    const nextButton = document.getElementById('next-question-button');
    const submitButton = document.getElementById('submit-quiz');
    const resultSection = document.getElementById('result-section');
    const mainContainer = document.getElementById('container');
    const body = document.body;
    const finalImage = document.getElementById('final-image');
    const finalImageWrapper = document.getElementById('final-image-wrapper');
    const finalPhraseElement = document.getElementById('final-phrase');

    const quizData = [
      {
        question: "Cosa speri che non vedano nei tuoi occhi?",
        options: ["La stanchezza", "La rabbia", "Il senso di colpa", "Il vuoto"]
      },
      {
        question: "Cosa dici quando stai male?",
        options: ["'Sto solo pensando'", "'Sono stanco'", "'Lasciami un po’ di spazio'", "Niente"]
      },
      {
        question: "A chi racconti la tua versione peggiore?",
        options: ["Nessuno", "A chi non potrà ferirmi", "A chi amo", "A me stesso"]
      },
      {
        question: "Cosa ti ferisce di più?",
        options: ["Essere dimenticato", "Non essere capito", "Sentirmi inadeguato", "Essere visto, davvero"]
      }
    ];

    let userAnswers = new Array(quizData.length).fill(undefined);
    let currentQuestionIndex = 0;

    function changeSection(hideSection, showSection, newBodyClass = null, newContainerClass = null) {
        hideSection.classList.remove('active');
        mainContainer.classList.add('transitioning'); // Aggiungi classe per la transizione del container

        // Nascondi l'immagine finale quando si cambia sezione
        finalImageWrapper.classList.add('hidden');

        setTimeout(() => {
            hideSection.style.display = 'none';

            // Rimuovi tutte le classi di fase precedenti
            body.classList.remove('phase-1', 'phase-2', 'phase-3');
            mainContainer.classList.remove('phase-1', 'phase-2', 'phase-3');

            // Applica le nuove classi di fase
            if (newBodyClass) {
                body.classList.add(newBodyClass);
            }
            if (newContainerClass) {
                mainContainer.classList.add(newContainerClass);
            }

            showSection.style.display = 'flex';
            showSection.offsetWidth; // Trigger reflow per animazione
            showSection.classList.add('active');

            // Mostra l'immagine finale solo se la sezione mostrata è resultSection
            if (showSection === resultSection) {
                finalImageWrapper.classList.remove('hidden');
            }

            mainContainer.classList.remove('transitioning');
        }, parseFloat(getComputedStyle(hideSection).transitionDuration) * 1000);
    }

    // Passaggio da intro a pre-quiz
    introImage.addEventListener('click', () => {
        changeSection(introSection, preQuizSection, 'phase-2', 'container phase-2');
    });

    startQuizButton.addEventListener('click', () => {
        changeSection(preQuizSection, quizSection, 'phase-2', 'container phase-2');
        userAnswers.fill(undefined);
        currentQuestionIndex = 0;
        renderQuestion();
    });

    function renderQuestion() {
        quizContent.innerHTML = '';
        const q = quizData[currentQuestionIndex];

        const div = document.createElement('div');
        div.classList.add('question-section');
        div.innerHTML = `<p>${currentQuestionIndex + 1}. ${q.question}</p>`;

        const optionsDiv = document.createElement('div');
        optionsDiv.classList.add('options');

        q.options.forEach((option, optionIndex) => {
            const input = document.createElement('input');
            input.type = 'radio';
            input.id = `q${currentQuestionIndex}o${optionIndex}`;
            input.name = `question${currentQuestionIndex}`;
            input.value = option;
            input.addEventListener('change', () => selectAnswer(currentQuestionIndex, option, input));

            const label = document.createElement('label');
            label.setAttribute('for', `q${currentQuestionIndex}o${optionIndex}`);
            label.innerText = option;

            optionsDiv.appendChild(input);
            optionsDiv.appendChild(label);

            if (userAnswers[currentQuestionIndex] === option) {
                input.checked = true;
                label.style.backgroundColor = 'var(--quiz-primary-color)';
                label.style.borderColor = 'var(--quiz-primary-color)';
                label.style.color = 'white';
            }
        });
        div.appendChild(optionsDiv);
        quizContent.appendChild(div);

        updateNavigationButtons();
    }

    function selectAnswer(questionIndex, answer, selectedInput) {
        userAnswers[questionIndex] = answer;

        const optionsLabels = selectedInput.parentElement.querySelectorAll('label');
        optionsLabels.forEach(label => {
            // Ripristina lo stile di base per tutte le label
            label.style.backgroundColor = 'var(--quiz-container-bg)';
            label.style.borderColor = 'var(--quiz-border-color)';
            label.style.color = 'var(--quiz-text-color)';
        });

        // Applica lo stile di selezione a quella scelta
        selectedInput.nextElementSibling.style.backgroundColor = 'var(--quiz-primary-color)';
        selectedInput.nextElementSibling.style.borderColor = 'var(--quiz-primary-color)';
        selectedInput.nextElementSibling.style.color = 'white';

        updateNavigationButtons();
    }

    function updateNavigationButtons() {
        prevButton.classList.toggle('hidden', currentQuestionIndex === 0);
        nextButton.classList.toggle('hidden', currentQuestionIndex === quizData.length - 1);
        submitButton.classList.toggle('hidden', currentQuestionIndex !== quizData.length - 1);

        const allAnswered = userAnswers.every(answer => answer !== undefined);
        submitButton.disabled = !allAnswered;
    }

    prevButton.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
        }
    });

    nextButton.addEventListener('click', () => {
        if (userAnswers[currentQuestionIndex] !== undefined) {
            if (currentQuestionIndex < quizData.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        } else {
            alert("Per favore, seleziona una risposta per questa domanda prima di continuare.");
        }
    });

    submitButton.addEventListener('click', () => {
        if (userAnswers.every(answer => answer !== undefined)) {
            showResult();
        } else {
            alert("Per favore, rispondi a tutte le domande.");
        }
    });

    function showResult() {
        const ul = document.getElementById('summary');
        ul.innerHTML = '';
        userAnswers.forEach((answer, index) => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${index + 1}. ${quizData[index].question}</strong> <br> &rarr; ${answer}`;
            ul.appendChild(li);
        });

        changeSection(quizSection, resultSection, 'phase-3', 'container phase-3');
    }

    finalImage.addEventListener('click', shareWhatsApp);

    function shareWhatsApp() {
        let whatsappMessage = "Ho scoperto il mio lato nascosto:\n\n";

        userAnswers.forEach((answer, index) => {
            whatsappMessage += `${index + 1}. ${quizData[index].question.replace(/^\d+\.\s/, '')} → ${answer}\n`;
        });

        whatsappMessage += `\n"${finalPhraseElement.textContent}"`;
        whatsappMessage += `\n\nScoprilo anche tu: ${window.location.href}`;

        const encodedMessage = encodeURIComponent(whatsappMessage);
        const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;

        window.open(whatsappUrl, '_blank');
    }
  </script>
</body>
</html>
